**Title:** Crack The Gate 2

**Difficulty:** Medium

**Summary (TL;DR):**

Exploiting Image upload misconfiguration to 

**1. Scope & Setup**

**Target:** http://amiable-citadel.picoctf.net:PORT/

**Environment:** Local System / PicoCTF VM

**Tools used:** Browser, text editor

**2. Recon**

From checking the network Tab, we can see that the website is running on Apache v2.4.62 (Debian)

<img width="373" height="464" alt="image" src="https://github.com/user-attachments/assets/6a3cee17-a6e8-4f74-86ca-1782b3a8d7f6" />

From Hint 1, we now know that we trick the server in this way. But uplaoding a .htaccess file didnt just magically give us the flag....

**3. Exploit**

So write 2 PHP scripts, one to tell the server to run .jpg files as .php , we name it as ```.htaccess.jpg``` 

<img width="492" height="155" alt="image" src="https://github.com/user-attachments/assets/0bef0e42-6557-4258-9f46-babc5d86a322" />

and another script that will actually get us the flag.

To test if our script works, we first send the a test command of ls, (make sure u save the script as .jpg)

<img width="513" height="243" alt="image" src="https://github.com/user-attachments/assets/f6a645c7-3ce8-4a46-9cd6-8bdc51ffb1f4" />

Upload this file, but ddont open, since server wont understand it. Go to network tab and open the header of the script we just sent. Click on "Resent"

[NOTE: You can also send .htaccess.jpg if it works for you, it didnt for me so I had to find a different way]

<img width="644" height="99" alt="image" src="https://github.com/user-attachments/assets/18dee683-57c8-4a04-938f-b5199804a60a" />

and change these:

<img width="495" height="89" alt="image" src="https://github.com/user-attachments/assets/2c06e4b8-5f13-4412-99f7-940e89de8189" />

TO 

<img width="485" height="120" alt="image" src="https://github.com/user-attachments/assets/57af67cb-fdb8-4a9e-ba42-24265e6677a8" />


**4. Post Exploit**

Once both files have been sent, open the script.jgp (or whatever you named it lol)

Since I used the ```ls -la``` command to test, this was the output:

<img width="498" height="167" alt="image" src="https://github.com/user-attachments/assets/2fc16be3-f7f3-41de-b9af-905bbba753cb" />

Now, do the same steps of resending the image, but this time finding the flag:

```
    <?php
    echo system("find / -names flag.* 2>/dev/null");
    ?>
```

Output:

<img width="654" height="193" alt="image" src="https://github.com/user-attachments/assets/8cab29f6-bd35-45e1-b6ee-c068dd5b9bfa" />

Edit and resend the header to cat the ```/var/www/flag.txt```
, And we have our flag. Congrats!

**5. Flag**

```
picoCTF{s3rv3r_byp4ss_e46b22e5}
```

**6. References/Credits**

https://www.youtube.com/watch?v=-s1KOzdj5ow
